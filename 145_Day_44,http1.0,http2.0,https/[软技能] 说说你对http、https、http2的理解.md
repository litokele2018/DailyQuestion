#### 深入理解 HTTP1.x、HTTP2、HTTPS

#### 一、HTTP/1.x
HTTP1.x
> + 缺陷， 在请求时会造成线程阻塞， 在同一时间， 同一域名的请求右一定数量的限制， 超过限制数目的请求会被阻塞。

HTTP 1.0
> + 缺陷： 浏览器与服务器只保持短暂的连接， 浏览器的每次请求都需要与服务器建立一个TCP连接（TCP连接的新建成本很高， 因为需要客户端和服务器端进行三次握手）， 服务器完成请求后立即断开TCP连接， 服务器不跟踪每个客户，也不记录过去的请求。
> + 解决方案：
>   + 添加头信息： 
>  非标准的Connection字段 [[Connection: keep-alive   ]]

HTTP 1.1
> + 改进点：
>   + **1.持久连接**
>     + 引入了持久连接， 即TCP连接默认不会断开， 可以被多个请求复用， 不用声明[[Connection：keep-alive]] （对统一个域名， 大多数浏览器允许同时建立6个持久连接）。
>   + **2.管道机制**
>     + 在同一个TCP连接中， 客户端可以同时发送多个请求。
>   + **3.分块传输编码**
>     + 即服务器每产生一块数据， 就发送一块， 采用流 [[Stream模式]] 取代了 [[缓存模式]]
>   + **4.新增请求方式**
>     + PUT： 让服务器存储一个客户端发送的资源。
>     + DELETE： 请求服务器删除标识的资源
>     + OPTIONS： 请求查询服务器的性能，或者查询与资源相关的选项和需求
>     + TRACE： 请求服务器回送收到的请求信息，主要用于测试或诊断。
>     + CONNECT： 保留将来使用
> + 缺陷：
>   + 虽然允许复用TCP连接， 但是同一个TCP连接里面， 所有的数据通讯都是[[按次序进行]]的。服务器只有处理完一个请求， 才会接着处理下一个请求， 如果前面的请求处理特别慢， 后面的请求就会排队等待， 会导致 [[队头阻塞]]
>   + **避免方式**： 减少请求次数， 同时开启多个持久连接。

#### HTTP2
> + 诞生背景
> HTTP/1.x 需要开启多个连接来实现并发和减少潜在的影响。 HTTP/1.x 的头部没有压缩， 造成不必要的网络阻塞， 并且， HTTP/1.x 没有采用资源的优先级响应， 重要的资源可能被最后才响应。
#### 1. 二进制帧层
> HTTP/2 采用 [[二进制传输]]， 不采用文本传输， 其性能的提升核心就在这。 
> 与HTTP/1.x的换行符分割文本不同， HTTP/2消息被分成很小的消息 [[frame]]， 每个消息帧(frame)和消息（Data）采用二进制编码。客服端和服务器端都采用二进制编码和解码。Headers也一样。
#### 2. 流、消息、帧
> **流**（stream）： 已经建立的连接之间的 [[双向流动的字节]]， 能携带一个或多个消息。
> **消息**（data）： 一个完整的帧序列， 他映射到逻辑的请求和响应消息。
> **帧**（frame）： 在HTTP/2通信的最小单元。

[**1.所有的通信都建立在一个TCP连接上，可以传递大量的双向流通的流。
2.每个流都有独一无二的标志和优先级。
3.每个消息都是逻辑上的请求和相应消息。由一个或者多个帧组成。
4.来自不同流的帧可以通过帧头的标志来关联和组装起来。**]

#### 3. 请求和响应的多路复用
> + **在HTTP/1.x** 中,用户想要多个并行的请求来提高性能,但是这样必须得使用多个TCP连接.这样的操作是属于HTTP/1.x 发送模型的直接序列.它能保证在每次连接中在一个时间点只有一个响应被发送出去.更糟糕的是,它使得队头阻塞和重要TCP连接的低效使用.
> + **在HTTP/2** 中,新的二进制帧层,解除了这个限制.使得所有的请求和响应多路复用.通过允许客户端和服务端把HTTP消息 [[分解]] 成独立的帧,交错传输,然后在 [[另一端组装]]。

![img](https://upload-images.jianshu.io/upload_images/5281821-ce9d374b7d0adf09.png?imageMogr2/auto-orient/strip|imageView2/2/w/654/format/webp)

1.交错的多个并行的请求或者,而不需要阻塞。
2.使用一个连接传递所有的并行的请求和响应。
3.移除了HTTP/1.x中没有的必要的解决方法.例如级联文件,域分片。
4.淘汰没必要的潜在因素来降低页面载入的时间.提升可用网络容积的使用率。
> [[新的二进制帧层解决了HTTP/1.X中头部阻塞的问题.在并行处理和传输的请求和响应不再需要多个连接。]]

#### 4. 流的优先级
为了能方便流的传输顺序,HTTP/2.0提出,使每个流都有一个权重和依赖
**每个流的权重值在1~256之间
每个流可以详细给出对其他流的依赖**

#### 5. 每个源一个连接
> HTTP/2.0的连接是持久的,每个源仅仅需要一个连接.大部分HTTP的传输是短的,并且突然的.然而TCP连接却适合长期存活的,批量的数据传输.通过利用相同的HTTP/2 连接,既能够充分利用TCP连接,也能减小整体协议的头部.更进一步来说,更少的连接内存的占用以及全连接路径的处理过程.向HTTP/2的转移不仅减少了网络潜在因素,更减少了操作代价。
#### 6. 流量控制
> 流量控制是一种机制,用来阻止发送者发送大量的接收者不需要,或者没能力处理的数据。

#### 7. 服务端推送
推送的资源可以由客户端缓存

推送的资源可以在不同的页面上重复使用

推送的资源可以与其他资源一起复用

推送的资源可以由服务器优先

推送的资源可以被客户拒绝

每个推送的资源都是一个流，与内联资源不同，它允许客户端对其进行单独复用，优先化和处理。由浏览器执行的唯一安全限制是推送资源必须遵守同源策略：服务器必须对提供的内容具有权限。

#### 8. 头部压缩

### 三、HTTPS